(()=>{"use strict";const t="https://npm.elemecdn.com/pjax@0.2.8/pjax.min.js",e=async()=>({Pjax:await new Promise(((e,n)=>{const a=document.createElement("script");a.src=t,a.onload=()=>e(window.Pjax),a.onerror=n,document.head.appendChild(a)}))});class n{constructor(t,e,n){this.tabList=document.querySelector(t),this.tabData=e,this.pjax=n,this.tabList&&(this.initTabs(),this.updateSelectedTab(window.location.pathname))}initTabs(){const t=this.tabData.map((t=>`\n            <li data-url="${t.url}" role="tab">\n                <a href="${t.url}" \n                   data-pjax \n                   data-lang-id="${t.text}"\n                   data-lang-params="[]"></a>\n            </li>\n        `)).join("");this.tabList.innerHTML=t,this.tabList.addEventListener("click",this.handleTabClick.bind(this))}async handleTabClick(t){const e=t.target.closest('[role="tab"]');if(!e)return;const n=e.dataset.url;if(n===window.location.pathname)return void t.preventDefault();t.preventDefault();const a=document.querySelector(".window");a&&a.classList.add("active"),this.updateSelectedTab(n);try{await this.pjax.loadUrl(n)}catch(t){}finally{a&&setTimeout((()=>{a.classList.remove("active")}),150)}}updateSelectedTab(t){this.tabList.querySelectorAll('[role="tab"]').forEach((e=>{const n=e.dataset.url,a=t===n;e.setAttribute("aria-selected",a),a?e.classList.add("active"):e.classList.remove("active")}))}}let a=!1,r=null,o=null;function i(){if(a)return;a=!0;const t=new Date,e=document.querySelector(".progress-container"),n=e?.clientWidth;if(!n)return void(a=!1);const s=Math.floor(n/30);function c(e,n,r,o){const i=(n-e)/6e4,c=(t-e)/6e4,l=Math.min(c/i*100,100),d=document.getElementById(r);if(!d)return void(a=!1);const u=Math.max(1,Math.floor(l/100*s)),m=document.getElementById(o);if(!m)return void(a=!1);m.innerHTML="",function t(e){if(e<u){const n=document.createElement("div");n.className="grid",m.appendChild(n),setTimeout((()=>t(e+1)),80*Math.random())}else a=!1}(0);let h=0;!function t(){h<l?(h+=1,d.textContent=`${Math.max(Math.floor(h),1)}%`,requestAnimationFrame(t)):d.textContent=`${Math.max(Math.floor(l),1)}%`}()}c(new Date(t.getFullYear(),0,1),new Date(t.getFullYear()+1,0,1),"progress-percentage","progress-bar"),c(new Date(t.getFullYear(),t.getMonth(),1),new Date(t.getFullYear(),t.getMonth()+1,1),"month-percentage","month-progress-bar"),c(new Date(t.getFullYear(),t.getMonth(),t.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),"day-percentage","day-progress-bar"),function(){const t=()=>{r&&clearTimeout(r),o&&document.removeEventListener("visibilitychange",o)},e=()=>{const t=document.getElementById("refresh-timer"),n=document.getElementById("refresh-container"),a=new Date,o=3600-(60*a.getMinutes()+a.getSeconds());if(t){const e=Math.floor(o/60),a=o%60;LangManager.applyParameters(t,"index_refresh",e,a),n&&(n.style.display="flex")}if(o>0)r=setTimeout(e,1e3);else try{i();const t=document.getElementById("refresh-timer");t&&LangManager.applyParameters(t,"timer.refresh_complete",(new Date).toLocaleTimeString())}catch(t){}},n=(t,e=50)=>{const n=()=>{document.getElementById("refresh-timer")?t():setTimeout(n,e)};n()};o=()=>{"visible"===document.visibilityState&&n(e)},document.addEventListener("visibilitychange",o),t(),LangManager.isInitialized?n(e):LangManager.init().then((()=>n(e)))}()}const s=async()=>{try{const t=await fetch("/cfg/article_cfg.json");if(!t.ok)throw new Error("配置加载失败");return(await t.json()).map((({id:t,url:e,icon:n,name:a})=>({id:t,url:`/post/${e}`,icon:`/icon/${n}`,name:a||"未命名"})))}catch(t){return[]}},c=(t,{url:e,icon:n})=>{const a=document.createElement("div");return a.className="link-preview",a.innerHTML=`\n        <div class="link-container" data-url="${e}">\n            <span class="link-icon" style="background-image: url('${n}')"></span>\n            <p class="link-title">${t}</p>\n        </div>\n    `,a},l=(t,e,n)=>{t.addEventListener("click",(t=>{const a=t.target.closest(".link-container");a?.dataset.url&&(t.preventDefault(),e.loadUrl(a.dataset.url),n.updateSelectedTab(a.dataset.url))}))};class d{static DEFAULT_CONFIG={debug:!1,version:"3.1",fallbackLang:"en",storageKey:"user_lang",langFile:"/cfg/lang_cfg.json",observerOptions:{subtree:!0,childList:!0,attributes:!0,attributeFilter:["data-lang-id"]},logger:console,placeholderFormats:["braced","numbered"]};constructor(t={}){this.config={...d.DEFAULT_CONFIG,...t},this.currentLang=this.config.fallbackLang,this.langData={},this.isInitialized=!1,this.domObserver=null,this.updateInProgress=!1,this.pendingUpdates=new Set,this.dynamicParams=new Map,this.paramCache=new Map}#t(...t){this.config.debug&&this.config.logger.log("%c[Lang]","color: #4CAF50;",...t)}#e(...t){this.config.logger.warn("%c[Lang]","color: #FFC107;",...t)}#n(...t){this.config.logger.error("%c[Lang]","color: #F44336;",...t)}#a(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.toString().replace(/[&<>"']/g,(t=>e[t]))}#r(t,e,n){return this.#n(`翻译失败 ${e}:`,n),t&&(t.classList.add("lang-error"),t.setAttribute("title",`翻译错误: ${e}`)),e}async#o(){try{const t=await fetch(`${this.config.langFile}?v=${Date.now()}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const e=await t.json();return this.langData=e.reduce(((t,e)=>e.id?(t[e.id]=Object.entries(e).reduce(((t,[e,n])=>("id"!==e&&(t[e]=n),t)),{}),t):(this.#e("跳过无效条目:",e),t)),{}),this.#t("语言数据加载成功"),!0}catch(t){return this.#n("语言数据加载失败:",t),this.langData={},!1}}#i(t,e=[]){return e.length?e.reduce(((t,e,n)=>{const a=this.#a(e);return this.config.placeholderFormats.includes("braced")&&(t=t.replace(new RegExp(`\\{${n}\\}`,"g"),a)),this.config.placeholderFormats.includes("numbered")&&(t=t.replace(new RegExp(`%${n+1}\\$s`,"g"),a)),t}),t):t}#s(){if(this.updateInProgress)return;this.updateInProgress=!0,this.pendingUpdates.forEach((t=>{this.#c(t)})),this.pendingUpdates.clear();document.querySelectorAll("[data-lang-id]").forEach((t=>{this.#c(t)})),this.updateInProgress=!1}#c(t){const e=t.dataset.langId;if(!e)return;const n=this.langData[e]||{};let a=n[this.currentLang]||n[this.config.fallbackLang]||e;const r=[...this.dynamicParams.get(e)||[],...JSON.parse(t.dataset.langParams||"[]")],o="INPUT"===t.tagName||"TEXTAREA"===t.tagName;try{a=this.#i(a,r),o?t.value=a:(a=a.replace(/\n/g,"<br>"),t.innerHTML=a)}catch(n){this.#r(t,e,n),o?t.value=e:t.innerHTML=e}}#l(){const t=document.getElementById("lang-switcher");if(!t)return;const e=t.cloneNode(!0);t.parentNode.replaceChild(e,t),e.value!==this.currentLang&&(e.value=this.currentLang),e.addEventListener("change",(async t=>{const e=t.target.value;e!==this.currentLang&&(this.#t(`切换语言至: ${e}`),this.currentLang=e,localStorage.setItem(this.config.storageKey,e),this.paramCache.clear(),this.#s())}))}#d(){this.domObserver||(this.domObserver=new MutationObserver((t=>{if(this.updateInProgress)return void t.forEach((t=>{"childList"===t.type?t.addedNodes.forEach((t=>{if(t.nodeType===Node.ELEMENT_NODE){t.hasAttribute("data-lang-id")&&this.pendingUpdates.add(t);t.querySelectorAll("[data-lang-id]").forEach((t=>this.pendingUpdates.add(t)))}})):"attributes"===t.type&&this.pendingUpdates.add(t.target)}));t.some((t=>"childList"===t.type&&Array.from(t.addedNodes).some((t=>t.nodeType===Node.ELEMENT_NODE&&(t.hasAttribute("data-lang-id")||t.querySelector("[data-lang-id]"))))||"attributes"===t.type&&"data-lang-id"===t.attributeName))&&(this.#s(),this.#l())})),this.domObserver.observe(document.documentElement,this.config.observerOptions))}applyParameters(t,e,...n){try{t.dataset.langId||(t.dataset.langId=e),this.dynamicParams.set(e,n);const a=this.translate(e,...n);return"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value=a:t.innerHTML=a.replace(/\n/g,"<br>"),!0}catch(n){return this.#r(t,e,n),!1}}bindDynamicElement(t,e,n){document.querySelectorAll(t).forEach((t=>{t.dataset.langId=e,this.dynamicParams.set(e,n(t)),this.pendingUpdates.add(t)})),this.#s()}cachedTranslate(t,...e){const n=`${t}_${e.join("_")}`;return this.paramCache.has(n)||this.paramCache.set(n,this.translate(t,...e)),this.paramCache.get(n)}async init(t=this.config.fallbackLang){this.isInitialized||(await new Promise((t=>{"complete"===document.readyState?t():window.addEventListener("load",t)})),this.currentLang=localStorage.getItem(this.config.storageKey)||t,await this.#o(),this.#s(),this.#l(),this.#d(),this.isInitialized=!0,this.#t("初始化完成"))}translate(t,...e){const n=this.langData[t]||{},a=n[this.currentLang]||n[this.config.fallbackLang]||t;return this.#i(a,e)}setLanguage(t){t!==this.currentLang&&(this.currentLang=t,localStorage.setItem(this.config.storageKey,t),this.paramCache.clear(),this.dynamicParams.forEach(((t,e)=>{document.querySelectorAll(`[data-lang-id="${e}"]`).forEach((t=>this.pendingUpdates.add(t)))})),this.#s())}getCurrentLang(){return this.currentLang}setParams(t,e=[]){Array.isArray(e)||(e=[e]),this.dynamicParams.set(t,e);document.querySelectorAll(`[data-lang-id="${t}"]`).forEach((t=>this.pendingUpdates.add(t))),this.updateInProgress||this.#s()}clearParams(t){this.dynamicParams.delete(t),this.setParams(t,[])}async reload(){await this.#o(),this.paramCache.clear(),this.#s()}configure(t){Object.assign(this.config,t)}enableDebug(t=!0){this.config.debug=t}}const u=new d;"undefined"==typeof window||window.LangManager||(window.LangManager=u);const m=u;function h(){const t=document.querySelector(".dynamic-footer");if(!t)return;const e=window.location.href.includes("post"),n=`\n      <div class="status-bar">\n        <p class="status-bar-field" data-lang-id="footer_name"></p>\n        <p class="status-bar-field" data-lang-id="footer_art"></p>\n        ${e?"":'<p class="status-bar-field" id="last-updated" data-lang-id="footer_update_time"></p>'}\n      </div>\n    `;if(t.innerHTML=n,!e){const e=t.querySelector("#last-updated"),n=async()=>{try{const t=await async function(){const t="https://api.github.com/repos/jianzou1/drunkfrog",e="lastUpdatedDate",n=36e5,a=localStorage.getItem(e);if(a){const{timestamp:t,date:e}=JSON.parse(a);if(Date.now()-t<n)return e}const r=await fetch(t);if(!r.ok)throw new Error(m.translate("errors.api_fetch",r.status));const o=await r.json(),i=new Date(o.updated_at).toLocaleString([],{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return localStorage.setItem(e,JSON.stringify({timestamp:Date.now(),date:i})),i}();m.applyParameters(e,"footer_update_time",t)}catch(t){m.applyParameters(e,"footer_update_time","---")}};m.isInitialized?n():m.init().then(n)}}function g(){const t=document.querySelector(".back-to-top");window.scrollY>300?t.style.display="block":t.style.display="none",t.onclick=function(){window.scrollTo({top:0,behavior:"smooth"})}}document.addEventListener("DOMContentLoaded",(function(){window.addEventListener("scroll",g),g()}));const p=1,f="/ui/dailyPopup.html",y="welcome-popup",w="overlay",E="close-popup";let b={popup:null,overlay:null,closeButton:null};function L(){document.addEventListener("DOMContentLoaded",v)}async function v(){const t=Date.now(),e=localStorage.getItem("dailyPopupLastShown"),n=e?new Date(e).getTime():0;(!e||(t-n)/1e3>=p)&&await async function(t,e,n){try{const n=await fetch(t);if(!n.ok)throw new Error(`Network response was not ok: ${n.statusText}`);e(await n.text())}catch(t){n?.(t)}}(f,S,(t=>{}))}function S(t){const e=(new DOMParser).parseFromString(t,"text/html"),n=document.createElement("div");n.innerHTML=e.body.innerHTML,document.body.appendChild(n),[...e.querySelectorAll("style, script")].forEach((t=>{const e=`${t.tagName.toLowerCase()}[data-id="${t.getAttribute("data-id")}"]`;document.querySelector(e)||document["STYLE"===t.tagName?"head":"body"].appendChild(t)})),b={popup:document.getElementById(y),overlay:document.getElementById(w),closeButton:document.getElementById(E)},function(){const{popup:t,overlay:e,closeButton:n}=b;if(!t||!e||!n)return;const a=t=>{"Escape"===t.key&&I()};let r=!1;const o=I;I=()=>{r||(r=!0,document.removeEventListener("keydown",a),o())},document.addEventListener("keydown",a),n.addEventListener("click",I),e.addEventListener("click",I),t.addEventListener("click",(t=>t.stopPropagation()))}(),localStorage.setItem("dailyPopupLastShown",(new Date).toISOString())}function I(){const{popup:t,overlay:e}=b;e&&(e.style.display="none"),t&&(t.style.display="none")}window.closePopup=I,L();let C=null,T=null;function M(){let t=[],e={},n=[];function a(e){let a;"按游戏评级排序"===e?a=function(){const e=t.reduce(((t,e)=>{const n=String(e.quality||"0");return t[n]||(t[n]=[]),t[n].push(e),t}),{}),a=[];return n.forEach((({key:t})=>{e[t]&&(a.push({key:t,games:e[t].sort(((t,e)=>e.time-t.time))}),delete e[t])})),Object.entries(e).sort(((t,e)=>e[0].localeCompare(t[0]))).forEach((([t,e])=>{a.push({key:t,games:e})})),a}():"按游戏类型排序"===e?a=r():"按游戏时长排序"===e&&(a=[...t].sort(((t,e)=>e.time-t.time))),o(a,e)}function r(){const e=function(t){return t.reduce(((t,e)=>{const n=e.type,a=e.seriesTag||"无系列";return t[n]=t[n]||{},t[n][a]=t[n][a]||[],t[n][a].push(e),t}),{})}(t);return Object.keys(e).forEach((t=>{Object.keys(e[t]).forEach((n=>{e[t][n].sort(((t,e)=>e.time-t.time))}))})),Object.keys(e).forEach((t=>{const n=Object.keys(e[t]);n.sort(((n,a)=>{const r=Math.max(...e[t][n].map((t=>t.time)));return Math.max(...e[t][a].map((t=>t.time)))-r})),e[t]=n.reduce(((n,a)=>(n[a]=e[t][a],n)),{})})),e}function o(t,a){const r=document.querySelector(".game-list");let o;o="按游戏评级排序"===a?t.map((({key:t,games:e})=>{const a=n.find((e=>e.key===t));return`<h3>${a?a.value:`未定义评级（${t}）`}</h3>${e.map(i).join("")}`})).join(""):"按游戏类型排序"===a?function(t,e={}){return Object.entries(t).map((([t,n],a,r)=>{const o=Object.entries(n).map((([t,e])=>e.map(i).join(""))).join("");return`<h3>${e[t]||""}</h3>${o}${a<r.length-1?"<hr>":""}`})).join("")}(t,e):Array.isArray(t)?t.map(i).join(""):"",r.innerHTML=o||"",r.querySelectorAll("li").forEach(((t,e)=>{setTimeout((()=>t.classList.add("flip-in")),12*e)}))}function i(t){const e=t.isLoved?"💜":"",n=t.sign||"",a=t.spacialAchievements?"🏆":"",r=t.spacialAchievements?t.spacialAchievements.replace(/\n/g,"<br>"):"",o=/^[A-Za-z0-9\s]+$/.test(t.name)?`<i>${t.name}</i>`:t.name;return`\n            <li class="${`quality-${t.quality||1}`}" ${r?'onclick="toggleAchievement(this)"':""}>\n                <span>\n                    <strong>${o}</strong> ${e} ${a}\n                </span>\n                <span>${n} ${t.time}小时 <span class="toggle-icon">${r?"🙈":""}</span></span>\n                <div class="achievement" style="display: none;">${r}</div>\n            </li>\n        `}!async function(){try{const c=await async function(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`网络错误: ${e.status}`);return e.json()}catch(t){throw t}}("/cfg/game_time_cfg.json");s=c[0][0].typeName,e=Object.fromEntries(s.split(",").map((t=>{const[e,n]=t.split(":");return[e.trim(),n.trim()]}))),i=c[0][0].qualityName,n=i.split(",").map((t=>{const[e,n]=t.trim().split(":");return{key:e.trim(),value:n.trim()}})),t=c[1]||[];const l=function(t){const e=t.reduce(((t,e)=>t+e.time),0),n=Math.floor(e/24),a=(e/24/365).toFixed(2);return{totalTime:e,totalDays:n,totalYears:a}}(t);!function({totalTime:t,totalDays:e,totalYears:n}){const a=(t,e)=>{try{const n=document.querySelector(`[data-lang-id="${t}"]`);n&&(n.dataset.langParams=JSON.stringify([e]),m.setParams(t,[e]))}catch(t){}};a("total_time",t),a("equivalent_days",e),a("equivalent_years",n),o(r())}(l),a("按游戏评级排序")}catch(t){}var i;var s}(),document.querySelectorAll('input[name="sort-option"]').forEach((t=>{t.addEventListener("change",(t=>{a(t.target.value)}))})),window.toggleAchievement=function(t){const e=t.querySelector(".achievement"),n=t.querySelector(".toggle-icon");if(!e)return;const a=t.nextElementSibling;if(a&&a.classList.contains("achievement-info"))a.remove(),n.innerHTML=e.innerHTML?"🙈":"";else{const r=document.createElement("div");r.className="achievement-info",r.innerHTML=e.innerHTML,t.parentNode.insertBefore(r,a),n.innerHTML="👀"}}}function x(){const t="/cfg/game_time_cfg.json",e=3,n=100,a=1500,r=30,o={isRolling:!1,gameData:[],currentWinner:null,loopData:[],currentPos:0,uniqueId:Date.now(),retryCount:0},i={rollBtn:null,result:null,container:null,items:[]},s={height:`${r}px`,lineHeight:`${r}px`,position:"absolute",width:"100%",transition:"transform 0.1s",willChange:"transform",backfaceVisibility:"hidden"};function c(){!o.isRolling&&o.gameData.length&&(m(),u())}function l(){i.result.innerHTML='<div class="error">系统初始化失败，请检查网络</div>'}function d(t={}){const{includeWinner:e=!0}=t,a=g([...o.gameData]),r=[],i=new Set;for(e&&o.currentWinner&&(r.push(o.currentWinner),i.add(o.currentWinner.name));r.length<n;){const t=a.filter((t=>!i.has(t.name)));if(0===t.length)break;const e=t[Math.floor(Math.random()*t.length)];r.push(e),i.add(e.name)}return g(r)}function u(){o.retryCount>3?o.isRolling=!1:(m(),o.currentWinner=function(){if(!o.gameData.length)return{name:"默认中奖",quality:1,_uid:++o.uniqueId};const t=o.gameData.map((t=>Math.pow(2,t.quality))),e=t.reduce(((t,e)=>t+e),0);let n=Math.random()*e;for(let e=0;e<o.gameData.length;e++){if(n<t[e])return o.gameData[e];n-=t[e]}return o.gameData[0]}(),o.currentWinner?(o.loopData=d(),o.retryCount++,o.loopData.some((t=>t._uid===o.currentWinner._uid&&t.name===o.currentWinner.name))?(o.retryCount=0,o.currentPos=0,h(),function(t){let e=null;const n=o.currentPos,s=c=>{e||(e=c);const l=c-e,d=Math.min(l/a,1),u=1-Math.pow(1-d,3);o.currentPos=n+t*u,h(),d<1?requestAnimationFrame(s):requestAnimationFrame((()=>{const t=i.result.offsetHeight,e=o.loopData.findIndex((t=>t._uid===o.currentWinner._uid)),n=Math.round(e*r-(t/2-r/2));o.currentPos=n,h();const a=document.getElementById("story");a&&(a.style.animation="none",a.offsetWidth,o.currentWinner?.story?a.textContent=o.currentWinner.story:a.textContent=" "),o.isRolling=!1}))};requestAnimationFrame(s)}(function(){const t=i.result.offsetHeight,e=o.loopData.findIndex((t=>t._uid===o.currentWinner._uid));return Math.round(e*r-(t/2-r/2))+n*r}())):u()):o.isRolling=!1)}function m(){i.result.offsetHeight,o.isRolling=!0;const t=document.getElementById("story");t&&(t.textContent=" ",t.style.animation="")}function h(){const t=o.loopData.length*r,e=(o.currentPos%t+t)%t,n=Math.floor(e/r),a=Math.round(e%r),s=Math.round(i.result.offsetHeight/2-r/2);i.items.forEach(((t,e)=>{const i=(n+e)%o.loopData.length,c=o.loopData[i],l=Math.round(e*r-a-s);t.textContent=c?.name||`游戏${e+1}`,t.className=`scroll-item quality-${c?.quality||1}`,t.style.transform=`translateY(${l}px)`,o.currentWinner&&c?._uid===o.currentWinner._uid?(t.style.fontWeight="bold",t.style.boxShadow="0 2px 8px rgba(255, 215, 0, 0.5)"):(t.style.fontWeight="",t.style.boxShadow="")}))}function g(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}new Promise(((t,e)=>{let n=0;const a=()=>{i.rollBtn=document.getElementById("gameRollBtn"),i.result=document.getElementById("gameResult"),i.rollBtn&&i.result?t():n++<20?setTimeout(a,50):e(new Error("DOM元素加载超时"))};a()})).then((()=>{!function(){i.container=document.createElement("div"),i.container.className="scroll-container",i.container.style.height=r*e+"px";const t=e+4;i.items=Array.from({length:t},((t,e)=>{const n=document.createElement("div");return n.className="scroll-item",Object.assign(n.style,s),n.textContent=`游戏${e+1}`,n})),i.result.appendChild(i.container),i.container.append(...i.items)}(),async function(){try{const e=new AbortController,a=setTimeout((()=>e.abort()),5e3),r=await fetch(t,{signal:e.signal});clearTimeout(a);const s=await r.json();!function(t){if(!t?.[1])throw new Error("无效的游戏数据格式")}(s),o.gameData=g(s[1]).map((t=>({...t,_uid:++o.uniqueId}))),o.loopData=o.gameData.length?d({includeWinner:!1}):Array.from({length:n},((t,e)=>({name:`游戏${e+1}`,quality:1,_uid:++o.uniqueId}))),h(),i.rollBtn.disabled=!1}catch(t){i.result.innerHTML='<div class="error">数据加载失败，请刷新页面</div>',i.rollBtn.disabled=!0}}(),i.rollBtn.addEventListener("click",c)})).catch(l)}const k="/cfg/gallery_cfg.json";async function D(){const t=document.getElementById("gallery-images"),e=document.getElementById("prevPage"),n=document.getElementById("nextPage"),a=document.getElementById("pageIndicator"),r=document.getElementById("titleSelect"),o=document.getElementById("topTitleDisplay"),i=document.getElementById("imageModal"),s=document.getElementById("modalImage"),c=document.getElementById("caption"),l=document.getElementById("modalClose");let d=1,u=[],m="",h=1;try{const t=await async function(){const t=await fetch(k);if(!t.ok)throw new Error("网络错误，请重试");return await t.json()}();m=t[0][0]?.additional||"",u=t[1],g=u,[...new Set(g.map((t=>t.title)))].forEach((t=>{const e=g.filter((e=>e.title===t)).length,n=document.createElement("option");n.value=t,n.textContent=`${t} (${e}p)`,r.appendChild(n)})),r.addEventListener("change",(function(){d=1,p()})),l.addEventListener("click",y),window.addEventListener("click",(function(t){t.target===i&&y()})),e.addEventListener("click",(()=>w(-1))),n.addEventListener("click",(()=>w(1))),p()}catch(t){alert("加载失败: "+t.message)}var g;function p(){t.innerHTML="";const i=r.value,s=u.filter((t=>t.title===i));h=Math.max(...s.map((t=>t.page)))||1;s.filter((t=>t.page===d)).forEach(f),a.textContent=`${d} / ${h} `,o.textContent=`${i}`,function(){const t=document.querySelectorAll("#gallery-images img"),e=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting){const n=t.target;n.src=n.getAttribute("data-src"),n.onload=()=>{n.style.opacity=1},e.unobserve(n)}}))}));t.forEach((t=>e.observe(t)))}(),e.disabled=1===d,n.disabled=d===h}function f(e){const n=document.createElement("img");n.setAttribute("data-src",e.url+m),n.alt=e.mark,n.title=e.mark,n.style.opacity=0,n.addEventListener("click",(()=>function(t){s.src=t.url,c.textContent=t.mark,i.style.display="flex"}(e))),t.appendChild(n)}function y(){i.style.display="none"}function w(t){d+=t,p()}}const A={CANVAS_CLASS:"crt-effect",CHECKBOX_ID:"crtToggle",STORAGE_KEY:"crtEffectEnabled",SCAN_LINE:{INTERVAL:4,SPEED:.06,COLORS:["rgba(255, 0, 0, 0.08)","rgba(0, 255, 0, 0.08)","rgba(0, 0, 255, 0.08)"],OSCILLATION:{FREQ:50,AMP:.2}}};let _=null,N=0;function $(){if(_)return N++,_;const t=document.querySelector(`.${A.CANVAS_CLASS}`);if(!t)return null;const e=t.getContext("2d");let n=!0,a=null,r=null,o=null;const i={resize:{handler:null,target:window},domReady:{handler:null,target:document},checkbox:{handler:null,target:null}};let s=0;const c=()=>{if(n){t.width===window.innerWidth&&t.height===window.innerHeight||(t.width=window.innerWidth,t.height=window.innerHeight),e.clearRect(0,0,t.width,t.height),e.fillStyle="rgba(0, 0, 0, 0.05)",e.fillRect(0,0,t.width,t.height);for(let n=0;n<t.height;n+=A.SCAN_LINE.INTERVAL){const a=s%A.SCAN_LINE.INTERVAL;A.SCAN_LINE.COLORS.forEach(((r,o)=>{const i=Math.sin(n/A.SCAN_LINE.OSCILLATION.FREQ)*A.SCAN_LINE.OSCILLATION.AMP,s=a+i+.3*o;e.fillStyle=r,e.fillRect(0,(n+s)%t.height,t.width,1)}))}s+=A.SCAN_LINE.SPEED,a=requestAnimationFrame(c)}},l=()=>{a&&(cancelAnimationFrame(a),a=null,e.clearRect(0,0,t.width,t.height))},d=t=>{try{localStorage.setItem(A.STORAGE_KEY,JSON.stringify(t))}catch(t){}},u=t=>{r||(r=t,i.checkbox.target=r,i.checkbox.handler=t=>{const e=t.target.checked;e!==n&&(n=e,d(e),e?c():l())},r.addEventListener("change",i.checkbox.handler),r.checked=n)},m=()=>{n=(()=>{try{const t=localStorage.getItem(A.STORAGE_KEY);return null===t||JSON.parse(t)}catch(t){return!0}})();const t=document.getElementById(A.CHECKBOX_ID);t?u(t):o||(o=new MutationObserver((t=>{for(const e of t)if("childList"===e.type){const t=document.getElementById(A.CHECKBOX_ID);t&&u(t)}})),o.observe(document.body,{childList:!0,subtree:!0,attributeFilter:["id"]})),n&&c()},h=()=>{l(),Object.values(i).forEach((({target:t,handler:e})=>{t&&e&&(t.removeEventListener("resize",e),t.removeEventListener("DOMContentLoaded",e),t.removeEventListener("change",e))})),o&&(o.disconnect(),o=null),r=null,_=null,N=0},g={enable(){n||(n=!0,d(!0),r&&(r.checked=!0),c())},disable(){n&&(n=!1,d(!1),r&&(r.checked=!1),l())},destroy(){N>0?N--:h()}};return i.resize.handler=()=>{n&&c()},i.resize.target.addEventListener("resize",i.resize.handler,{passive:!0}),"loading"===document.readyState?(i.domReady.handler=m,i.domReady.target.addEventListener("DOMContentLoaded",i.domReady.handler,{once:!0})):m(),_=g,N=1,g}const O=["/ui/ascii1.txt","/ui/ascii2.txt"],P=async()=>{const t=(()=>{const t=Math.floor(Math.random()*O.length);return O[t]})(),e=await fetch(t),n=await e.text(),a=document.querySelector(".logo");if(a){let t=a.querySelector(".text-container");t||(t=document.createElement("div"),t.classList.add("text-container"),a.appendChild(t)),t.textContent=n;const e=a.offsetWidth,r=document.createElement("span");r.textContent=n,r.style.fontFamily="Courier New, Courier, monospace",r.style.fontSize="14px",r.style.whiteSpace="pre",document.body.appendChild(r);const o=r.offsetWidth;document.body.removeChild(r);const i=e/o;t.style.transform=`translate(-50%, -50%) scale(${i})`}},q=[["/cfg/article_cfg.json","/cfg/game_time_cfg.json","/cfg/gallery_cfg.json"],["/icon/application-x-gamecube-rom.png","/icon/application-x-genesis-rom.png","/icon/application-x-nes-rom.png","/icon/text-markdown.png","/icon/computer-fail.png"],["/favicon/android-chrome-192x192.png"]],j={js:"script",css:"style",jpg:"image",jpeg:"image",png:"image",gif:"image",webp:"image",svg:"image",woff2:"font",woff:"font",ttf:"font",eot:"font",json:"fetch",html:"document",txt:"fetch"};function B(t){return new Promise((e=>{const n=function(t){const e=t.split(".").pop().toLowerCase().split(/[?#]/)[0];return j[e]||"fetch"}(t),a=document.createElement("link");a.rel="preload",a.href=t,a.as=n,"font"===n&&(a.crossOrigin="anonymous"),a.onload=()=>{e()},a.onerror=t=>{e()},document.head.appendChild(a)}))}async function H(t,e=3){const n=[...t];let a=0;const r=[];return new Promise((t=>{!function o(){if(0!==n.length||0!==a)for(;n.length>0&&a<e;){const t=n.shift();a++;const e=B(t).finally((()=>{a--,o()}));r.push(e)}else Promise.all(r).then(t)}()}))}(async()=>{try{await m.init(),P(),async function(t=q){if("requestIdleCallback"in window)try{"complete"!==document.readyState&&await new Promise((t=>window.addEventListener("load",t,{once:!0}))),await new Promise((t=>requestIdleCallback(t,{timeout:3e3})));for(const e of t)await H(e,2)}catch(t){}}();const{Pjax:t}=await e(),a=new t({selectors:["head title","#main"],cacheBust:!1}),r=[{url:"/",text:"tab_progress"},{url:"/page/article.html",text:"tab_article"},{url:"/page/game.html",text:"tab_game"},{url:"/page/gallery.html",text:"tab_gallery"},{url:"/page/about.html",text:"tab_about"}],o=new n('[role="tablist"]',r,a);document.addEventListener("pjax:complete",(()=>{d()}));const d=()=>{try{switch(window.location.pathname){case"/":i(),L();break;case"/page/article.html":!async function(t,e){const n=await s(),a=document.getElementById("links-container");a&&(a.innerHTML="",n.forEach((t=>{a.appendChild(c(t.name,{url:t.url,icon:t.icon}))})),l(a,t,e))}(a,o);break;case"/page/game.html":M(),x();break;case"/page/gallery.html":D()}h(),g(),async function(){await m.init(),T=document.getElementById("tips");const t=t=>{t.forEach((t=>{t.addEventListener("mouseenter",e),t.addEventListener("mouseleave",n)}))},e=t=>{C=t.target,a(),r(),T.style.display="block",T.style.opacity=1},n=()=>{C=null,T.style.display="none",T.style.opacity=0},a=()=>{if(!C)return;const t=C.getAttribute("data-tips");T.textContent=m.translate(t)},r=()=>{if(!C)return;const t=C.getBoundingClientRect();T.style.left=`${t.left+window.scrollX+80}px`,T.style.top=`${t.bottom+window.scrollY+0}px`};document.addEventListener("languageChanged",(()=>{C&&"block"===T.style.display&&(a(),r())}));const o=document.querySelectorAll("[data-tips]");t(o);new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{if(e.nodeType===Node.ELEMENT_NODE){e.hasAttribute("data-tips")&&t([e]);const n=e.querySelectorAll("[data-tips]");t(n)}}))}))})).observe(document.body,{childList:!0,subtree:!0})}(),$();const t=document.querySelector('[role="tablist"]');t&&(t.innerHTML="",new n('[role="tablist"]',r,a))}catch(t){}};d()}catch(t){}})()})();